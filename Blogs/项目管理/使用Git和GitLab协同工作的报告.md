# 使用Git和GitLab协同工作的报告
@(开发工具)[Git, GitLab]

[TOC]

## Git和GItLab简介
### Git简介
- Git是一个`分布式`**版本控制系统( Version Control System)**
> 分布式相比于集中式的**最大区别**在于开发者可以提交到本地，每个开发者通过克隆（git clone），在本地机器上拷贝一个**完整的Git仓库**
### GitLab
-  GitLab是利用 `Ruby on Rails` 一个开源的版本管理系统，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。它拥有**与Github类似的功能**，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。
### 使用Git与GitLab协同开发带来的优势
- Git是SVN与相比，是一个非常强大的版本控制系统，其强大在于**分布式理念**和**多分支管理**。学会了Git，对编程的思想也会有一定的提升。
- GitLab支持**在线检视代码**，开发人员互相检视代码是快速提高技术的一种手段，相比于面对面的代码检视，GITLAB提供的代码检视不再只是走个流程，而是真正的能够给开发人员指出问题的所在，并提供相应的修改意见。从而也**提高了代码质量**。
- GitLab保证了产品质量，在gitlab上存在两个长期分支`Master`、`Develop`，在开发过程中只有项目经理、架构师等责任人才允许将开发者开发并通过检视的代码分支合并到`Develop`分支，当`Develop`分支达到稳定并可以正式发布时，才将其合并到`Master主分支`。从而保证了`Master`分支的绝对干净和产品的高质量。
    - `Master分支`用来存放对外发布的版本，任何时候在这个分支拿到的，都是稳定的发布版
    - `Develop分支`用于日常开发，存放最新的开发版
    
- GitLab支持`Wiki`、`Issues`等功能，可以在`WIKI`上撰写项目的架构设计/说明、使用的技术知识点、入门指南等相关博文，引导开发人员/新员工尽快熟悉产品，并尽快的投入到开发工作中。开发人员可以在`Issues`寻求帮助(技术的、非技术的)，测试人员提交BUG，团队人员也可以在上面提交产品改建意见，参与讨论等。
- GitLab可以设置**里程碑** ，从而保证了开发进度。
    - 可以每周设置一个里程碑，并将该周需要完成的开发任务放到里程碑中，根据实际完成的进度来记录当前开发状态
    - 也可以根据模块点来设置里程碑，将每个模块的开发任务放到里程碑中。
- GitLab可以统计每个开发人员的代码量，从而衡量每个开发者对产品的贡献率。
- 其他：
     - GitLab还支持CI集成、自动化部署、邮件通知、甚至可以通过GitLab提供的API来扩展GItLab的功能等  

### 使用Git存在的风险
- `GIT`的学习成本相对较高，对一个从未接触过GIT的开发人员来说，想要学会git并理解GIT的`功能驱动式开发`，需要一定学习成本和缓冲期。
- 在学习`GIT`过程中，因为受`SVN`思想影响，对GIT的`分布式架构`理念和`多分支管理`难以理解。
- 在GIT和GITLAB的使用中，如果不够规范，可能会导致一些列的困惑。

### 规避风险的办法
- GIT的命令相对较多且命令行手册说明均是英文的，对于英文较差和不习惯使用命令行的新手来说，使用GIT的命令来管理版本库，无疑是不太可能的，不过无论是在`Windows系统`还`Mac系统`下均提供了图形化客户端来对GIT仓库进行管理；
    - `Windows系统`下使用`TortoiseGit`来管理GIT仓库非常容易学习和掌握，但是也需要对`git`和`Gitlab flow`的一些**基本概念**需要有一定的认识。
    - `Mac系统`下可以使用`SourceTree`来管理GIT仓库。
- 建议公司组织git的相关培训。
- 在GITLAB的WIKI上撰写`git`、`gitlab flow`使用的相关博文，遇到问题时，可以发布在`Issues`请求帮助。
- 建议新手在GitLab上建立一个仓库，并实际练习GIT和GitLab的使用方法。
- 深入理解Git的`工作区`、`索引/暂存区`、`仓库`，以及他们之间的联系及区别。
## 公司使用GIT的可行性分析
### 目前公司产品存在的问题
- 架构设计的相对简单，耦合度非常高，扩展和维护均非常难。一个良好的架构应当是*可维护*，*易扩展*，*灵活度*非常高的，并且减少开发人员的工作量的。而公司目前的产品根本无法做到这一点，即便简单的对数据库某个表的字段增减都异常困难，实体之间并没有任何关联，本应该是简单的查询及获取关联对象都非常的难以实现，无疑是增加了开发人员的工作量
- 代码质量非常低，没有统一的编码规范，代码看起来杂乱无章。
	- 一个优秀的产品应当是团队中无论多开发人员参与开发，代码风格应当是看起来一致的。
	- 代码首先是给开发人员看的，所以应当做到易于理解，简单、美观。一个优秀的开发者不会多写一行代码，目前产品中的冗余代码太多，缺乏有效的重构，无法做到`DRY原则`。
- 缺乏有效的代码走查机制，无法保证产品的质量，目前公司的代码走查机制基本处于摆设状态。
- 没有有效的机制跟进开发进度，开发进度评估不准确从而导致的与实际开发工作出现偏差，无法做到有效的风险防范。
### 将版本管理切换到GIT的可行性分析
**背景：**目前公司已经考虑重写`虚拟仿真平台`的架构，公司也希望能够对现有的产品升级换代，但是对一个优秀的框架来说，`敏捷`与`开源`的思想必不可或缺，只有通过**持续不断的重构**，才能持续不断的提升产品的质量，减少开发人员的工作量，提高团队的开发水平。
- 目前`虚拟仿真平台`系列产品是一个依靠同一个产品框架，根据不同的职业院校或教育行业的业务需求调整得到一系列**衍生产品**，但是框架本身的低质量，高耦合造成了整个系列产品难以为维护，开发任务重，开发人员技术水平难以提高的瓶颈。
- 对于该类型的产品而言，使用GIT与GITLAB协同来开发是一个非常不错的选择。
    - 以`开源的思想`构建产品框架：建议创建一个`GTA.VSL`小组，将产品线内的开发人员、产品经理、测试加入到该小组内，团队均可以对该产品做贡献。包括对产品的WIKI撰写、在ISSUES上对产品的建议、对BUG的提交，项目责任人可以在上面发布相关任务，开放人员在上面认领任务等。
    - 以`敏捷的思想`持续提高产品质量，高质量的产品的开发不是一蹴而就的，应当持续不断的对框架进行重构，不断的减少代码的耦合度，增加模块的内聚性，从而得到一个可持续使用的框架，不同的产品项目组可以随时在 `Master分支`上得到一个可以在生产线使用的框架。
- 将版本管理切换到GIT与GitLab上，困难在于GIT的使用上，但GIT的使用并不是真的难到无法学会，只要有学习意愿，加上适当的培训和练习，配合`TortoiseGit`，至多两个星期均能达到熟练使用的地步。
### 将版本管理切换到GIT的收益
- 规范开发流程与项目管理，有助于提升产品质量，提高企业竞争力
- 提高团队凝聚力，并且有效的提高团队人员的学习能力、技术水平
- 有效的代码走查机制，能够有效确保的提高代码质量，提高团队开发人员的技术水平，促进相互学习
- 可以得到一个优秀的框架，在衍生不同产品时，能够有效的减少开发人员的工作量，节省开发成本
- 凝聚团队智慧，持续不断的提高产品质量、性能
- 衍生产品不会污染基础框架
## 使用GIT协同GitLab开发的流程[建议]
-  建议在GitLab上维护两个长期分支:`master`和`develop`分支，并且这两个分支应当是受保护的，`master`分支用来存放可以在生产线上使用的框架，`develop`用来存放开发阶段的代码库，存放开发阶段最新的版本，只有当开发达到一个阶段时，才可以将`develop`分支合并到`master`分支。
-  开发人员的开发流程：
	1. 开发人员将GitLab上`develop`分支的代码库克隆到本地，并在本地代码库拉取一个`develop`分支，作为本地的开发分支；
	2. 根据开发特性，完成新功能开发时，拉取分支`feature-xxx`，开发新的功能， 如果需要修复bug时，拉取新的分支在`bug-xxx`bug修复功能；
	3. 完成开发功能后，将代码提交到本地仓库
	4. 开发人员切回到`develop`分支，并将之前的`feature-xxx`或`bug-xxx`分支下的代码合并到`develop`分支
	5. 对提交的日志进行管理，如合并本地多次提交的日志，每个功能应当作为一个原子性的特性，只需要有一个日志提交
	6. 将本地代码`push`到gitlab上的`远程仓库`，不允许开发人员直接将代码直接push到`master`分支和`develop`分支，每次功能性开发或是bug修复是应当在远程仓库中建立一个短期分支
	6. 开发人员在gitlab上发起`request merge`请求
	7. 项目经理/架构师或相应责任人指定代码检视人，代码检视人根据开发规范及业务流程对开发人员的代码进行检视
	8. 开发人员根据检视意见对代码进行合理的修改，并将修改的代码再次`push`到远程仓库
	9. 重复7-8步骤，直到开发人员的代码达到编码规范要求、产品质量要求时，由项目责任人将代码合并到`develop`分支
	10. 当代码合并到`develop`分支后，应当及时将远程仓库和本地仓库的短期分支及时删除，防止分支太多或是或是变得凌乱，使得代码库变得难以维护
	11.  当远程分支上的`develop`分支上的产品达到一个可以发布的版本时，由项目责任人合并到`master`分支，产品线上的任何项目组在该分支上应当随时可以得到稳定的、可用的基础性框架

> **注意：**  
> - 尽量保证开发与分支管理的规范，建议在本地仓库中，**不要**在`master`和`develop`分支上直接开发，应当每开发一个功能时或是修复一个bug时都应当在一个独立的分支中进行，开发完成后，切回`develop`分支，将代码合并到`develop`分支，并`push`远程仓库的一个短期分支
> - 当项目责任人将代码合并到远程仓库中的`develop`分支时，应当及时删除本地和远程仓库的短期分支，避免管理过多过杂的分支
> - 在将代码库`push`到远程仓库之前，应当先`fetch`远程仓库，并与处于上游的`origin/develop`进行`rebase`，与最新的代码进行合并，防止项目责任人在合并到`develop`分支时，发生不必要的冲突


## Gitlab `WIKI` `Issues` `里程碑`的使用
### Wiki的使用
- 提供了博文撰写的功能，建议使用`MarkDown`语言来撰写
### Issues的使用
- 可以发布、管理开发任务
- 可以寻求技术、非技术帮助
- 可以发起对产品改进的意见
### 里程碑的使用
- 与Isssues配合使用，用来跟进当前开发进度，规避开发上的风险

	
## GIT的学习网站
- [猴子都懂的GIT](http://backlogtool.com/git-guide/cn/)
- [常用 Git 命令清单](http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html?utm_source=tool.lu)
- [Git 工作流程](http://www.ruanyifeng.com/blog/2015/12/git-workflow.html)
- [廖雪峰的GIT教程](http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/)
