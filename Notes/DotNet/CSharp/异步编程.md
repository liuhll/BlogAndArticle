# 异步编程
## 什么是异步？

异步操作通常用于执行完成时间可能较长的任务，如打开大文件、连接远程计算机或查询数据库。异步操作在主应用程序线程以外的线程中执行。应用程序调用方法异步执行某个操作时，应用程序可在异步方法执行其任务时继续执行。

## 同步与异步的区别

- 同步（`Synchronous`）：在执行某个操作时，应用程序必须等待该操作执行完成后才能继续执行。

- 异步（`Asynchronous`）：在执行某个操作时，应用程序可在异步操作执行时继续执行。**实质：** 异步操作，启动了新的线程，`主线程`与`方法线程`**并行执行**。

## 异步和多线程的区别    

      我们已经知道，异步的实质是开启了新的线程。它与多线程的区别是什么呢？

      简单的说就是：异步线程是由线程池负责管理，而多线程，我们可以自己控制，当然在多线程中我们也可以使用线程池。

      就拿网络扒虫而言，如果使用异步模式去实现，它使用线程池进行管理。异步操作执行时，会将操作丢给线程池中的某个工作线程来完成。当开始I/O操作的时候，异步会将工作线程还给线程池，这意味着获取网页的工作不会再占用任何CPU资源了。直到异步完成，即获取网页完毕，异步才会通过回调的方式通知线程池。可见，异步模式借助于线程池，极大地节约了CPU的资源。

>  注：`DMA（Direct Memory Access）`直接内存存取，顾名思义DMA功能就是让设备可以绕过处理器，直接由内存来读取资料。通过直接内存访问的数据交换几乎可以不损耗CPU的资源。在硬件中，硬盘、网卡、声卡、显卡等都有直接内存访问功能。异步编程模型就是让我们充分利用硬件的直接内存访问功能来释放CPU的压力。
      两者的应用场景：

- `计算密集型工作`，采用多线程。
- `IO密集型工作`，采用异步机制。

## 异步应用

.NET Framework 的许多方面都支持异步编程功能，这些方面包括：
1. `文件IO`、`流IO`、`套接字IO`。
2. `网络`。
3. 远程处理`信道`（HTTP、TCP）和`代理`。
4. 使用 ASP.NET 创建的 XML Web services。
5. ASP.NET Web 窗体。
6. 使用 `MessageQueue`类的消息队列。      

.NET Framework 为异步操作提供两种设计模式：
 1. 使用 `IAsyncResult` 对象的异步操作。
 2. 使用事件的异步操作。     
- `IAsyncResult`设计模式允许多种编程模型，但更加复杂不易学习，可提供大多数应用程序都不要求的灵活性。可能的话，类库设计者应使用事件驱动模型实现异步方法。在某些情况下，库设计者还应实现基于 `IAsyncResult`的模型。

- 使用 `IAsyncResult `设计模式的异步操作是通过名为 `Begin操作名称`和`End操作名称`的两个方法来实现的，这两个方法分别开始和结束异步操作操作名称。
   - 例如，`FileStream` 类提供 `BeginRead` 和 `EndRead` 方法来从文件异步读取字节。这两个方法实现了 `Read 方法`的异步版本。在调用 `Begin`操作名称后，应用程序可以继续在调用线程上执行指令，同时异步操作在另一个线程上执行。每次调用 `Begin`操作名称 时，应用程序还应调用 `End`操作名称来获取操作的结果。`Begin`操作名称 方法开始异步操作操作名称并返回一个实现 `IAsyncResult` 接口的对象。 `.NET Framework` 允许您**异步调用任何方法**。定义与您需要调用的方法具有相同签名的委托；公共语言运行库将自动为该委托定义具有适当签名的 `BeginInvoke` 和 `EndInvoke `方法。   

`IAsyncResult` 对象存储有关异步操作的信息。下表提供了有关异步操作的信息。

| 名称 |  说明 |
|:---------:|:------------:|
| AsyncState | 获取用户定义的对象，它限定或包含关于异步操作的信息。 |
| AsyncWaitHandle | 获取用于等待异步操作完成的 `WaitHandle。` |
| CompletedSynchronously | 获取一个值，该值指示异步操作是否同步完成。 |
| IsCompleted | 获取一个值，该值指示异步操作是否已完 |