# .net 反射 

- [.NET Framework 中的反射](https://msdn.microsoft.com/zh-cn/library/f7ykdhsy(v=vs.110).aspx)

`System.Reflection` 命名空间中的类与 `System.Type` 使你能够获取有关加载的`程序集`和其中定义的`类型`的信息，如`类`、`接口`和`值类型`

`程序集`包含**模块**、`模块`包含**类型**，而`类型`包含**成员**


`反射`提供封装`程序集`、`模块`和`类型`的对象，
使用反射可以获取有关类型的信息并且成员是不受限制的


- 可以**使用`反射`动态地创建类型的实例**，将类型绑定到现有对象，或从现有对象中获取类型
- 可以调用类型的方法或访问其字段和属性

## 反射的典型用法
- 使用 `Assembly` 来**定义和加载程序集**，加载程序集清单中列出的模块，以及在此程序集中定位一个类型并创建一个它的实例。
- 使用 `Module` 发现信息，如包含模块的程序集和模块中的类。 还可以获取所有全局方法或模块上定义的其它特定的非全局方法。
- 使用 `ConstructorInfo` 发现信息，如名称、参数、访问修饰符（如 `public` 或 `private`）和构造函数的实现详细信息（如 `abstract`或 `virtual`）。 使用 `Type` 的 `GetConstructors` 或 `GetConstructor`方法来调用特定构造函数。
- 使用 `MethodInfo` 发现信息，如名称、返回类型、参数、访问修饰符（如 `public` 或 `private`）和方法的实现详细信息（如 `abstract` 或 `virtual`）。 使用 `Type` 的 `GetMethods` 或 GetMethod 方法来调用特定方法。
- 使用 `FieldInfo` 发现信息，如名称、访问修饰符（如 `public` 或 `private`）和一个字段的实现详细信息 （如 `static`）；并获取或设置字段值。
- 使用 `EventInfo` 发现信息（如名称、事件处理程序的数据类型、自定义特性、声明类型以及事件的反射的类型），并添加或删除事件处理程序。
- 使用 `PropertyInfo` 发现信息（如名称、数据类型、声明类型，反射的类型和属性的只读或可写状态），并获取或设置属性值。
- 使用 `ParameterInfo` 发现信息，如参数的名称、数据类型、参数是输入参数还是输出参数以及参数在方法签名中的位置。
- 使用 `CustomAttributeData` 在于应用程序域的仅反射上下文中工作时发现有关自定义特性的信息。 `CustomAttributeData` 使你能够检查特性，而无需创建它们的实例。


`System.Reflection.Emit` 命名空间的类提供一种**专用形式的反射**，使你能够在`运行时`生成类型。


## 反射中的运行时类型
### 反射提供类
- 如 `Type` 和 `MethodInfo`，用于表示类型、成员、参数和其它代码实体

## 查看类型信息
`System.Type` 类对于反射起着**核心**的作用  
使用`Assembly.GetType` 或 `Assembly.GetTypes` 从尚未加载的程序集中获取 `Type` 对象，并传入所需类型的名称

## 反射类型和泛型类型
`泛型类型`和`普通类型`之间的区别在于泛型类型具有与之关联的一组类型形参（若是泛型类型定义）或类型实参（若是构造类型）
- 反射如何处理泛型类型和方法?
  1. **泛型类型定义**和**泛型方法定义**的类型参数由 `Type` 类的实例表示
  2. 如果 `Type` 的实例表示泛型类型，则它包含表示`类型形参`（对于泛型类型定义）或`类型实参`（对于构造类型）的**类型数组**

### 这是泛型类型还是泛型方法？
- 检查未知类型（由 `Type` 的实例表示）时,使用 `IsGenericType` 属性来确定未知类型是否为泛型 
- 当检查未知方法（由 `MethodInfo` 类的实例表示）时，请使用 `IsGenericMethod` 属性来确定此方法是否为泛型
### 这是泛型类型定义还是泛型方法定义？
-  `IsGenericTypeDefinition` 属性
-  `IsGenericMethodDefinition`属性



## 反射的安全注意事项
- 使用`反射`可以获取有关类型的信息并且成员是不受限制的
- 使用`反射`来访问成员会受到限制,从 `.NET Framework 4` 开始，只有**受信任的代码**才能使用反射来访问`关键安全成员`。

## 如何：使用反射将委托挂钩？
- [使用反射将委托挂钩](https://msdn.microsoft.com/zh-cn/library/ms228976(v=vs.110).aspx)



