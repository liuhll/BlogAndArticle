# 数据卷

`数据卷`是一个可供一个或多个**容器**使用的*特殊目录*，它绕过 `UFS`，可以提供很多有用的**特性**

- `数据卷`可以在**容器之间**共享和重用
- 对`数据卷`的修改会**立马生效**
- 对`数据卷`的更新，**不会影响镜像**
- `数据卷`默认会**一直存在**，
    - 即使容器被删除

> **Notes**
> - `数据卷`的使用，类似于 `Linux` 下对**目录**或**文件**进行 `mount`，
> - `镜像`中的被指定为**挂载点的目录中的文件会隐藏掉**，能显示看的是挂载的`数据卷`

## 创建一个数据卷

- `数据卷`是被设计用来**持久化数据的**，
- 它的**生命周期**独立于`容器`，`Docker`**不会**在`容器`被删除后自动删除数据卷，并且也**不存在**垃圾回收这样的机制来处理没有任何容器引用的数据卷。
- 如果需要在删除容器的同时移除数据卷。
    - 可以在删除容器的时候使用 `docker rm -v` 这个命令。
- **无主的数据卷**可能会占据很多空间，要清理会很麻烦。
   - `Docker`官方正在试图解决这个问题，相关工作的进度可以查看这个[PR](https://github.com/docker/docker/pull/8484)。


## 挂载一个主机目录作为数据卷

- 使用 `-v` 标记也可以指定挂载一个**本地主机的目录**到`容器`中去。
```bash
$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py
```
> **说明**
> - 加载**主机**的 `/src/webapp` 目录到**容器**的 `/opt/webapp` 目录
>     - 这个功能在进行测试的时候十分方便
>     - 比如用户可以放置一些程序到本地目录中，来查看容器是否正常工作
> - 本地目录的路径**必须是绝对路径**，
>       - 如果*目录不存在* `Docker` 会自动为你创建它
> - `Dockerfile` 中不支持这种用法
>      - 这是因为 `Dockerfile` 是为了移植和分享用的

- `Docker` `挂载数据卷`的默认权限是**读写**，用户也可以通过 `:ro` 指定为**只读**
```bash
$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp:ro training/webapp python app.py #加了 :ro 之后，就挂载为只读了。
```

## 查看数据卷的具体信息
- 在`主机`里使用以下命令可以查看指定容器的信息
```bash
$ docker inspect web
```

- 在输出的内容中找到其中和数据卷相关的部分，可以看到所有的数据卷都是创建在主机的`/var/lib/docker/volumes/`下面的

```json
"Volumes": {
    "/webapp": "/var/lib/docker/volumes/fac362...80535"
},
"VolumesRW": {
    "/webapp": true
}
...
```

## 挂载一个本地主机`文件`作为数据卷

- `-v` 标记也可以从主机挂载单个文件到`容器`中
```bash
$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash
```
> 这样就可以记录在`容器`输入过的命令了


