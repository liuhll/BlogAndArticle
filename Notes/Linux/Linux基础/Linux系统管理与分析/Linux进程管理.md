# Linux进程管理

## 进程
当我们运行程序时，Linux会为程序创建一个**特殊的环境**，该环境**包含程序运行需要的所有资源**，以保证程序能够**独立运行**，不受其他程序的干扰----该特殊的环境就称为`进程`

- 每个Linux 命令都与系统中的程序对应，输入命令，Linux 就会创建一个**新的进程**
- 简而言之，**`进程`就是程序的实例**

### pid /进程ID
系统通过一个**五位数字**跟踪程序的运行状态，这个数字称为 `pid`(进程ID)

- 每个进程都拥有唯一的 `pid`

> **Notes**  
> - 理论上，**五位数字是有限的**，当数字被用完时，下一个 `pid` 就会重新开始，所以 `pid` 最终会重复。
> - 但是，两个 pid 一样的进程**不能同时存在**，因为Linux会使用 `pid` 来跟踪程序的运行状态。

## 创建进程
创建进程有两种方式：**前台进程**和**后台进程**

### 前台进程
*默认情况下*，用户创建的进程都是`前台进程`；
- `前台进程`从键盘读取数据，并把处理结果输出到显示器
- 可以看到`前台进程`的运行过程

当程序运行在前台时，由于命令提示符(`$`)还未出现，用户不能输入其他命令；
即使程序需要运行很长时间，也必须等待程序运行结束才能输入其他命令

### 后台进程
- `后台进程`与键盘**没有必然**的关系
- 当然，`后台进程`也可能会**等待**键盘输入。
- 优点：
   - `后台进程`的优点是**不必等待程序运行结束就可以输入其他命令**
- 创建后台进程  
   - 最简单的方式就是在命令的末尾加 `&`
   ```
   $ls ch*.doc &
   ``` 

## 查看正在运行的进程
可以使用 `ps` 命令查看进程的运行状态，包括`后台进程`
- `-f` 选项
   - `f` 是 *full* 的缩写，可以查看更多信息

```
$ps -f
UID      PID  PPID C STIME    TTY   TIME CMD
amrood   6738 3662 0 10:23:03 pts/6 0:00 first_one
```   

- 每列的含义

| 列 |	描述 |
|:---|:------|
| UID |	进程所属用户的ID，即哪个用户创建了该进程。 |
| PID |	进程ID。 |
| PPID |	父进程ID，创建该进程的进程称为父进程。 |
| C	| CPU使用率。 |
| STIME |	进程被创建的时间。 |
| TTY |	与进程有关的终端类型。 |
| TIME |	进程所使用的CPU时间。 |
| CMD |	创建该进程的命令。 |

- `ps`的参数

| 选项 |	说明 |
|:---|:------|
| -a |	 显示所有用户的所有进程。 |
| -x |	 显示无终端的进程。 |
| -u |	显示更多信息，类似于 `-f` 选项。 |
| -e |	显示所有进程 |

## 终止进程

- 进程运行在**前台**时：
   - 通过 `kill` 命令或 `Ctrl+C` 组合键来结束进程
- 进程**运行**在后台：
   1. 首先要通过 `ps` 命令来获取`进程ID`，
   2. 然后使用 `kill` 命令**杀死**进程

- `kill -9 `
   - [kill及kill -9的用法及如何实现进程的优雅退出](http://www.2cto.com/os/201305/215267.html)   

## 父进程和子进程
- 每个 Linux 进程会包含**两个进程ID**,(可以暂时认为所有的进程都有父进程)
   1. 当前进程ID(`pid`)
   2. 父进程ID(`ppid`)

- 由用户运行的大部分命令都将 `Shell` **作为父进程**
- 使用 `ps -f` 命令可以查看`当前进程ID`和`父进程ID`。   

## 僵尸进程和孤儿进程
**正常情况下**: 子进程被终止时会通过 SIGCHLD 信号通知父进程，父进程可以做一些清理工作或者重新启动一个新的进程

### 孤儿进程
在某些情况下，父进程会在子进程之前被终止，那么这些子进程就**没有了“父亲”**，被称为`孤儿进程`
- `init 进程`会成为所有孤儿进程的`父进程`
- `init` 的 `pid` 为*1*，是Linux系统的第一个进程，也是所有进程的父进程

### 僵尸进程
如果一个**进程被终止**了，但是使用 `ps` 命令**仍然可以查看该进程**，**并且状态为 `Z`**，那么这就是一个`僵尸进程`
- `僵尸进程`虽然被终止了，但是仍然存在于进程列表中
- 杀死僵尸进程
   - 一般僵尸进程很难杀掉
   - 你可以先杀死他们的父进程，让他们变成孤儿进程
   - `init` 进程会自动清理**僵尸进程**

## 常驻进程
一般是**系统级进程**，以 `root 权限`运行在**后台**，*可以处理其他进程的请求*
- 常驻进程**没有终端**，**不能**访问 `/dev/tty` 文件
- 如果使用`ps -ef` 查看该进程，`tty` 这一列会显示问号(`?`)
- 常驻进程通常运行在后台，**等待指定事件发生**

## top命令
`top` 命令是一个很有用的工具，它可以**动态显示**正在运行的进程，还可以按照指定条件对进程进行排序，
- 与`Windows`的`任务管理器`类似
- `top` 命令可以显示进程的**很多**信息
   - 包括`物理内存`、`虚拟内存`、`CPU使用率`、`平均负载`以及`繁忙`的进程

  
## 任务和进程
### 任务(`task`)
是最**抽象**的，是一个*一般性的术语*，指**由软件完成的一个活动**
- 一个任务既可以是**一个进程**，也可以是**多个进程**
- **简而言之**，它指的是一系列*共同达到*某一目的的操作
- 每个任务都有一个数字表示的`任务号`
> **例如**  
> 读取数据并将数据放入内存中。这个任务可以由一个进程来实现，也可以由多个进程来实现

- `jobs` 命令
  - 可以用来查看系统中*正在运行的任务*，包括`后台运行的任务`
  - 该命令可以显示`任务号`及其对应的`进程ID`
  - 一个任务可以对应于**一个或者多个**进程号
  - `jobs` 命令的 `-l` 选项可以查看当前任务包含的进程ID

### 进程
`进程(process)`常常被定义为**程序的执行**
- 可以把一个**进程**看成是*一个独立的程序*，在内存中有其**完备的数据空间**和**代码空间**。
- 一个`进程`所拥有的`数据`和`变量`**只属于它自己**


## 前台任务和后台任务的切换
- `fg` 命令可以将后台任务调到前台

```
$ fg %jobnumber
```

- `bg` 命令可以将后台**暂停**的任务，调到前台继续运行
```
$ bg %jobnumber
```
> **注**：  
> `jobnumber` 是通过 `jobs`命令获取的后台任务的的序号，注意**不是**`pid`。
> 如果前台只有一个任务，可以不指定 `jobnumber`。   

- 将当前任务转移到后台
  - 可以先 `Ctrl+z` 暂停任务，再使用 `bg` 命令
  - 任务转移到后台可以**空出终端**，继续输入其他命令