# Linux系统性能分析

- 免费的`系统性能分析工具`,使用这些工具可以监控系统资源使用情况，便于发现**性能瓶颈**

系统的整体性能取决于**各种资源的平衡**,**某种资源的耗尽**会严重阻碍系统的性能

  ![木桶理论](http://c.biancheng.net/cpp/uploads/allimg/140902/1-140Z2123R4253.png)

-  Linux中需要监控的资源
    - `CPU`、
    - `主存`（`内存`）、
    - `硬盘空间`、
    - `I/O`时间、
    - `网络时间`、
    - `应用程序`  

## 影响系统性能的主要因素

| 因素 |	说明 |
|:-----|:-----|
| 用户态CPU |	CPU在`用户态`**运行用户程序**所花费的时间，包括`库调用`，但是**不包括** *内核花费的时间*。 |
| 内核态CPU |	CPU在`内核态`**运行系统服务**所花费的时间。所有的 `I/O 操作`都需要调用系统服务，程序员可以通过阻塞 `I/O 传输`来影响这部分的时间。 |
| `I/O` 时间和网络时间 |	响应 `I/O` 请求、处理网络连接所花费的时间。 |
| 内存 |	`切换上下文`和`交换数据`（虚拟内存页导入和导出）花费的时间。 |
| 应用程序 |	`程序等待运行的时间`——`CPU`正在运行其他程序，等待切换到当前程序。 |    

> **Notes**  
> 一般认为用`户态CPU`和`内核态CPU`花费的时间**小于70%**时是良好状态

## 下面的命令可以用来监控系统性能并作出相应调整

| 命令 |	说明 |
|:-----|:------|
| nice |	启动程序时指定`进程优先级`。
| renice |	调整现有`进程的优先级`。
| netstat |	显示**各种网络相关信息**，包括:<br>- 网络连接情况、<br>- 路由表、<br>- 接口状态(`Interface Statistics`)、<br>- masquerade 连接、<br>- 多播成员 (`Multicast Memberships`)等。<br> 实际上，`netstat` 用于显示与`IP`、`TCP`、`UDP`和`ICMP协议`相关的统计数据，一般用于检验本机各端口的网络连接情况。
| time |	检测一个命令运行时间以及资源（`CPU`、`内存`、`I/O`等）使用情况。
| uptime |	查看系统负载情况。
| ps |	查看系统中`进程的资源`使用情况（**瞬时状态**，*不是* **动态监控**）。
| vmstat |	报告虚拟内存使用情况。
| gprof	 | 精确分析程序的性能，能给出函数调用时间、调用次数、调用关系等。
| top	| **实时监控**系统中各个进程资源的资源使用情况。


- 常用命令组合
   - `vmstat`、`sar`、`mpstat`检测是否存在`CPU瓶颈`；
   - `vmstat`、`free`检测是否存在**内存瓶颈**；
   - `iostat`检测是否存在`磁盘I/O瓶颈`；
   - `netstat`检测是否存在`网络I/O瓶颈`。